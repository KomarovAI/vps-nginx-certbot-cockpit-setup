# Marzban Custom Container

Кастомный Docker контейнер для Marzban с автоматической инициализацией и настройкой Reality.

## Особенности

- ✓ **Автоматическая инициализация** - настройка контейнера при первом запуске
- ✓ **Генерация Reality ключей** - автоматическое создание ключей если не заданы
- ✓ **Проверка зависимостей** - валидация конфигурации и настроек
- ✓ **Health checks** - мониторинг состояния сервиса
- ✓ **Простое управление** - Makefile с командами для разработки

## Быстрый старт

### 1. Настройка окружения

```bash
# Копирование примера конфигурации
make setup-env

# Редактирование .env файла
nano .env
```

### 2. Сборка и запуск

```bash
# Полное развертывание
make deploy

# Или пошагово:
make build  # Сборка контейнера
make up     # Запуск сервисов
```

### 3. Проверка состояния

```bash
# Просмотр логов
make logs

# Проверка здоровья сервиса
make health
```

## Команды Makefile

| Команда | Описание |
|---------|-------------|
| `make build` | Сборка кастомного контейнера |
| `make up` | Запуск сервисов |
| `make down` | Остановка сервисов |
| `make restart` | Перезапуск сервисов |
| `make logs` | Просмотр логов |
| `make shell` | Открытие shell в контейнере |
| `make health` | Проверка состояния |
| `make clean` | Очистка контейнеров и образов |
| `make gen-keys` | Генерация Reality ключей |
| `make deploy` | Полное развертывание |

## Конфигурация

### Основные параметры .env

```env
# Обязательные
DOMAIN_NAME=your-domain.com

# Опциональные
MARZBAN_PANEL_PORT=8000
XRAY_PORT=2083
XRAY_REALITY_SERVER_NAMES=google.com,www.google.com
```

### Автоматические настройки

Контейнер автоматически:
- Генерирует Reality ключи если не заданы
- Создает конфигурацию Xray из шаблона
- Проверяет зависимости и настройки
- Настраивает права доступа

## Интеграция с основным проектом

Для интеграции с основным docker-compose.yml:

```yaml
services:
  marzban:
    build: ./marzban
    container_name: marzban
    networks:
      - main-network
    # ... остальные настройки
```

## Логи и отладка

```bash
# Просмотр логов инициализации
make logs | grep "MARZBAN-INIT\|REALITY-INIT\|DEPS-CHECK"

# Открытие шелла для отладки
make shell
```

## Порты

- **8000** - Marzban панель управления
- **2083** - Xray VLESS Reality (по умолчанию)